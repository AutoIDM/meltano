image: python:3.6
variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache"

stages:
  - test
  # - production

lighthouse:
  image: "femtopixel/google-lighthouse"
  stage: test
  artifacts:
    paths:
      - "/builds/meltano/meltano/lighthouse-results.html"
  script:
    - apt-get install build-essential
    - curl -O https://www.python.org/ftp/python/3.7.2/Python-3.7.2.tgz
    - tar -xvzf Python-3.7.2.tgz
    - cd Python-3.7.2 && ./configure && make && make install
    - lighthouse --output-path="./lighthouse-results.html" --chrome-flags="--headless --disable-gpu" http://jacobschatz.com
